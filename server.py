from flask import Flask, render_template, jsonify, request
import pickle
import json
import prediction as p

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/ranking')
def ranking():
    sort_type = request.args.get("sort_type")
    if sort_type == "random_forests":
        forests_rank = pickle.load(open("data/ranking/forests_ranking.pkl", "rb" ))
        return jsonify(forests_rank)
    if sort_type == "lasso":
        lasso_rank = pickle.load(open("data/ranking/lasso_ranking.pkl", "rb" ))
        return jsonify(lasso_rank)
    
@app.route('/eval', methods = ['POST'])
def eval_data():
    feature_map = {};
    feature_name = json.loads(request.form.get("feature_name"))
    feature_value = json.loads(request.form.get("feature_value"))
    
    for i in range(len(feature_name)):
        feature_map.update({feature_name[i]: feature_value[i]}) 
    label = p.get_Prediction(feature_map)
    return jsonify(label)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8081, debug = True)